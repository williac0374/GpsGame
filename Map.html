<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map with Sword and Monster</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>
        #map {
            height: 100vh;
            width: 100%;
        }
        /* Style for sword and monster markers */
        .sword-icon, .monster-icon {
            background-size: cover;
            width: 40px;
            height: 40px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <audio id="powerup-sound" src="Powerup.mp3"></audio>

    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script>
        let map, userMarker, monsterMarker;
        let userPosition = { lat: 0, lng: 0 };
        const monsterDistanceThreshold = 15; // meters
        const halfMileInMeters = 804.672; // meters

        function initMap() {
            navigator.geolocation.getCurrentPosition(function (position) {
                userPosition = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                // Initialize the map centered on user's location
                map = L.map('map').setView([userPosition.lat, userPosition.lng], 15);

                // Add OpenStreetMap tiles
                L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    maxZoom: 19,
    attribution: 'Tiles Â© Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
}).addTo(map);


                // Create sword marker (user's location)
                const swordIcon = L.icon({
                    iconUrl: 'sword.png', // URL to sword image
                    iconSize: [40, 40]
                });

                userMarker = L.marker([userPosition.lat, userPosition.lng], { icon: swordIcon }).addTo(map);

                // Create initial monster marker at a random location
                placeMonsterMarker();

                // Continuously update user's position and check proximity to monster
                watchUserPosition();
            });
        }

        // Generate a random point within half a mile on the map
        function placeMonsterMarker() {
            const randomPoint = generateRandomPoint(userPosition, halfMileInMeters);

            if (monsterMarker) {
                map.removeLayer(monsterMarker); // Remove the previous monster marker
            }

            const monsterIcon = L.icon({
                iconUrl: 'orc.png', // URL to monster image
                iconSize: [40, 40]
            });

            monsterMarker = L.marker([randomPoint.lat, randomPoint.lng], { icon: monsterIcon }).addTo(map);
        }

        // Function to continuously update the user's location and check distance
        function watchUserPosition() {
            navigator.geolocation.watchPosition(function (position) {
                userPosition = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                userMarker.setLatLng([userPosition.lat, userPosition.lng]);

                // Check the distance between user and monster
                const distance = calculateDistance(userPosition, monsterMarker.getLatLng());

                if (distance <= monsterDistanceThreshold) {
                    document.getElementById('powerup-sound').play(); // Play the power-up sound
                    placeMonsterMarker(); // Move monster to new random location
                }
            });
        }

        // Generate a random point within a given radius (meters) from the origin
        function generateRandomPoint(origin, radius) {
            const y0 = origin.lat;
            const x0 = origin.lng;

            const rd = radius / 111300; // 111300 meters in one degree

            const u = Math.random();
            const v = Math.random();

            const w = rd * Math.sqrt(u);
            const t = 2 * Math.PI * v;
            const x = w * Math.cos(t);
            const y = w * Math.sin(t);

            const newX = x + x0;
            const newY = y + y0;

            return { lat: newY, lng: newX };
        }

        // Function to calculate distance between two points in meters
        function calculateDistance(point1, point2) {
            const R = 6371000; // Radius of the Earth in meters
            const dLat = toRad(point2.lat - point1.lat);
            const dLon = toRad(point2.lng - point1.lng);
            const lat1 = toRad(point1.lat);
            const lat2 = toRad(point2.lat);

            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(lat1) * Math.cos(lat2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c; // Distance in meters
        }

        function toRad(deg) {
            return deg * (Math.PI / 180);
        }

        initMap(); // Initialize the map
    </script>
</body>
</html>
